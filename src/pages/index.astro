---
import Layout from '../layouts/Layout.astro'
import Hero from '../components/Hero.astro'
import QualityCards from '../components/QualityCards.astro'
import FeaturedProducts from '../components/FeaturedProducts.astro'
import Testimonials from '../components/Testimonials.astro'
import Newsletter from '../components/Newsletter.astro'

const seoData = {
  title: 'Artilate — Handcrafted Chocolates from Colombian Cacao',
  description:
    'Premium bean-to-bar chocolates and filled bonbons made in Alberta. Ethically sourced Colombian cacao, handcrafted in small batches.',
  ogType: 'website' as const,
  schemaExtras: {
    '@type': ['LocalBusiness', 'FoodEstablishment'],
    servesCuisine: 'Artisanal Chocolates',
    menu: '/shop',
    hasMenu: {
      '@type': 'Menu',
      name: 'Chocolate Selection',
      hasMenuSection: [
        {
          '@type': 'MenuSection',
          name: 'Bonbons',
          hasMenuItem: [
            { '@type': 'MenuItem', name: 'Classic Box of 9', offers: { '@type': 'Offer', price: '25', priceCurrency: 'CAD' } },
            { '@type': 'MenuItem', name: 'Tropical Box of 9', offers: { '@type': 'Offer', price: '25', priceCurrency: 'CAD' } }
          ]
        },
        {
          '@type': 'MenuSection',
          name: 'Chocolate Bars',
          hasMenuItem: [
            { '@type': 'MenuItem', name: 'Dark with Pistachio (40g)', offers: { '@type': 'Offer', price: '6', priceCurrency: 'CAD' } }
          ]
        }
      ]
    }
  },

  /* ✅ Preload SOLO del candidato AVIF que será LCP (~420px)
     - NO mezclar AVIF y WebP en el mismo imagesrcset del <link>
     - href apunta al 420w para que el navegador no baje el 640w por defecto
  */
  preloadImages: [
    {
      href: '/assets/hero-img-420.avif',
      as: 'image',
      fetchpriority: 'high',
      imagesrcset: [
        '/assets/hero-img-420.avif 420w',
        '/assets/hero-img-560.avif 560w',
        '/assets/hero-img-640.avif 640w'
      ].join(', '),
      imagesizes: '(max-width:768px) 88vw, (max-width:1200px) 42vw, 420px'
    }
  ],

  // canonical: 'https://artilate.com/'
}
---

<Layout {...seoData}>
  <Hero />
  <QualityCards />
  <FeaturedProducts />
  <Testimonials />
  <Newsletter />
</Layout>

<style>
  :global(.scroll-reveal){opacity:0;transform:translateY(30px);transition:opacity .8s cubic-bezier(.16,1,.3,1),transform .8s cubic-bezier(.16,1,.3,1)}
  :global(.scroll-reveal.revealed){opacity:1;transform:translateY(0)}
  :global(.fade-in-left){opacity:0;transform:translateX(-40px);transition:opacity .8s cubic-bezier(.16,1,.3,1),transform .8s cubic-bezier(.16,1,.3,1)}
  :global(.fade-in-left.revealed){opacity:1;transform:translateX(0)}
  :global(.fade-in-right){opacity:0;transform:translateX(40px);transition:opacity .8s cubic-bezier(.16,1,.3,1),transform .8s cubic-bezier(.16,1,.3,1)}
  :global(.fade-in-right.revealed){opacity:1;transform:translateX(0)}
</style>

<script is:inline>
  const observer = new IntersectionObserver((entries)=> {
    entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('revealed'); });
  }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.scroll-reveal, .fade-in-left, .fade-in-right')
      .forEach(el => observer.observe(el));
  });
</script>
