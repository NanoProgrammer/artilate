---
import Layout from '../../../layouts/Layout.astro'

const sp = Astro.url.searchParams
const orderId = sp.get('order') ?? sp.get('orderId') ?? sp.get('oid') ?? 'â€”'
export const prerender = true;
const seoData = {
  title: 'Order Confirmed â€” Artilate Handcrafted Chocolates',
  description: `Thank you! Your order ${orderId !== 'â€”' ? '#' + orderId : ''} was received. Weâ€™re preparing your handcrafted chocolates in Alberta.`,
  noindex: true
}
---

<Layout {...seoData}>
  <main class="error-page">
    <div class="container">
      <div class="error-content">
        <!-- Crack SVG (decorativo) -->
        <div class="chocolate-crack">
          <svg viewBox="0 0 800 200" class="crack-svg" aria-hidden="true">
            <path class="crack-line" d="M50,100 Q200,80 300,100 T500,120 Q600,110 750,100" stroke="url(#crackGradient)" stroke-width="3" fill="none"/>
            <path class="crack-line secondary" d="M100,90 Q250,105 400,95 T650,85" stroke="url(#crackGradient)" stroke-width="2" fill="none"/>
            <path class="crack-line tertiary" d="M200,110 Q350,125 500,115 T700,105" stroke="url(#crackGradient)" stroke-width="1.5" fill="none"/>
            <defs>
              <linearGradient id="crackGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:#D4A373;stop-opacity:0" />
                <stop offset="20%" style="stop-color:#D4A373;stop-opacity:0.8" />
                <stop offset="50%" style="stop-color:#F59E0B;stop-opacity:1" />
                <stop offset="80%" style="stop-color:#D4A373;stop-opacity:0.8" />
                <stop offset="100%" style="stop-color:#D4A373;stop-opacity:0" />
              </linearGradient>
            </defs>
          </svg>
        </div>

        <h1 class="error-title">Thank you for your order!</h1>
        <p class="error-description">
          {orderId !== 'â€”' ? `Order #${orderId} confirmed.` : 'Your order has been confirmed.'}
          Weâ€™ve emailed your receipt and next steps.
        </p>

        <div class="error-actions">
          <a href="/shop" class="primary-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/>
            </svg>
            Continue Shopping
          </a>
        </div>

        <div class="suggested-links">
          <h3>Explore more:</h3>
          <nav class="quick-links">
            <a href="/about" class="quick-link">Our Story</a>
            <a href="/faq" class="quick-link">FAQ</a>
            <a href="/contact" class="quick-link">Contact</a>
          </nav>
        </div>

        <!-- PartÃ­culas -->
        <div class="chocolate-particles">
          <div class="particle particle-1"></div>
          <div class="particle particle-2"></div>
          <div class="particle particle-3"></div>
          <div class="particle particle-4"></div>
          <div class="particle particle-5"></div>
          <div class="particle particle-6"></div>
        </div>
      </div>
    </div>
  </main>

  <style>
    :root { --cacao-black:#0A0B0D; --warm-ivory:#FAFAF9; --gold:#D4A373; --amber:#F59E0B; --warm-gray:rgba(250,250,249,.8); }
    body { background: var(--cacao-black); color: var(--warm-ivory); line-height:1.6; overflow-x:hidden; }
    .container { max-width:1280px; margin:0 auto; padding:0 2rem; }

    .error-page {
      min-height: calc(90vh);
      display:flex; align-items:center; justify-content:center;
      position:relative; padding-bottom:32px;
      background:
        radial-gradient(ellipse at 30% 20%, rgba(91,33,182,.08) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 80%, rgba(245,158,11,.06) 0%, transparent 50%);
      text-align:center;
    }
    .error-content { position:relative; z-index:2; max-width:800px; margin:0 auto; }

    .chocolate-crack{ margin-bottom:1rem; opacity:0; animation:crackAppear 1s ease-out .5s forwards; }
    .crack-svg{ width:100%; max-width:600px; height:120px; }
    .crack-line{ stroke-dasharray:1000; stroke-dashoffset:1000; animation:drawCrack 2s ease-out .8s forwards; }
    .crack-line.secondary{ animation-delay:1.2s; opacity:.7; }
    .crack-line.tertiary{ animation-delay:1.6s; opacity:.4; }
    @keyframes crackAppear{ to{ opacity:1 } }
    @keyframes drawCrack{ to{ stroke-dashoffset:0 } }

    .error-title{
      font-family:'Playfair Display', serif;
      font-size:clamp(2rem,5vw,3.5rem); font-weight:600; margin-bottom:1rem;
      text-shadow:0 4px 20px rgba(212,163,115,.3);
      opacity:0; transform:translateY(20px); animation:slideUp .8s ease-out 1.2s forwards;
    }
    .error-description{
      font-size:1.125rem; color:var(--warm-gray); max-width:560px; margin:0 auto 2.25rem; line-height:1.7;
      opacity:0; transform:translateY(20px); animation:slideUp .8s ease-out 1.5s forwards;
    }
    @keyframes slideUp{ to{ opacity:1; transform:translateY(0) } }

    .error-actions{
      display:flex; gap:1rem; justify-content:center; flex-wrap:wrap; margin-bottom:2.5rem;
      opacity:0; transform:translateY(20px); animation:slideUp .8s ease-out 1.8s forwards;
    }
    .primary-btn, .secondary-btn{
      border-radius:12px; padding:14px 28px; font-weight:600; text-decoration:none; display:inline-flex; align-items:center; gap:10px;
      transition: all .4s cubic-bezier(.16,1,.3,1); position:relative; overflow:hidden;
    }
    .primary-btn{
      background:linear-gradient(135deg, var(--gold) 0%, var(--amber) 100%); color:#0A0B0D;
      box-shadow:0 8px 32px rgba(212,163,115,.3), 0 2px 16px rgba(0,0,0,.1);
    }
    .primary-btn::before{
      content:''; position:absolute; inset:0; left:-100%;
      background:linear-gradient(90deg, transparent, rgba(255,255,255,.2), transparent);
      transition:left .6s ease;
    }
    .primary-btn:hover::before{ left:100% }
    .primary-btn:hover{ transform:translateY(-3px); box-shadow:0 12px 40px rgba(212,163,115,.4), 0 4px 20px rgba(0,0,0,.15); }
    .secondary-btn{
      background:rgba(212,163,115,.08); color:var(--warm-ivory); border:1px solid rgba(212,163,115,.22); backdrop-filter:blur(8px);
    }
    .secondary-btn:hover{ border-color:rgba(212,163,115,.4); transform:translateY(-2px); box-shadow:0 8px 24px rgba(0,0,0,.12); }

    .suggested-links{ opacity:0; transform:translateY(20px); animation:slideUp .8s ease-out 2.1s forwards; }
    .quick-links{ display:flex; gap:1.25rem; justify-content:center; flex-wrap:wrap; }
    .quick-link{ color:rgba(212,163,115,.85); text-decoration:none; font-weight:500; position:relative; padding:6px 0; transition:color .3s ease; }
    .quick-link::after{ content:''; position:absolute; bottom:2px; left:0; width:0; height:1px; background:var(--gold); transition:width .3s ease; }
    .quick-link:hover{ color:var(--gold) } .quick-link:hover::after{ width:100% }

    .chocolate-particles{ position:absolute; inset:0; pointer-events:none; overflow:hidden; }
    .particle{ position:absolute; width:6px; height:6px; background:var(--gold); border-radius:50%; opacity:.3; animation:float 6s ease-in-out infinite; }
    .particle-1{ top:20%; left:10%; animation-delay:0s } .particle-2{ top:60%; left:85%; animation-delay:1s }
    .particle-3{ top:80%; left:20%; animation-delay:2s } .particle-4{ top:30%; left:70%; animation-delay:3s }
    .particle-5{ top:10%; left:60%; animation-delay:4s } .particle-6{ top:70%; left:40%; animation-delay:5s }
    @keyframes float{ 0%,100%{ transform:translateY(0) scale(1); opacity:.3 } 50%{ transform:translateY(-20px) scale(1.2); opacity:.6 } }

    @media (max-width:768px){ .container{ padding:0 1.25rem } .primary-btn,.secondary-btn{ width:100%; max-width:280px; justify-content:center } }
  </style>
   <script is:inline>
(async () => {
  try {
    if (window.__artilateConversionSent) return;
    window.__artilateConversionSent = true;

    const params = new URLSearchParams(window.location.search);
    const sessionId = params.get("session_id");
    if (!sessionId) return;

    const res = await fetch(`/api/checkout?session_id=${sessionId}`);
    if (!res.ok) return;
    const data = await res.json();

    if (!data || !data.amount_total || !data.currency || !data.id) return;

    // ðŸ”¥ GA4 purchase COMPLETO
    gtag('event', 'purchase', {
      transaction_id: data.id,
      value: data.amount_total,
      currency: data.currency.toUpperCase(),
      items: [
        {
          item_id: "artilate_order",
          item_name: "Artilate Order",
          quantity: 1,
          price: data.amount_total
        }
      ]
    });

    // ðŸ”¥ Google Ads conversion (esto sÃ­ sirve asÃ­)
    gtag('event', 'conversion', {
      send_to: 'AW-17710658719/wq67CJeHgskbEJ_pjP1B',
      value: data.amount_total,
      currency: data.currency.toUpperCase(),
      transaction_id: data.id
    });

  } catch (e) {
    console.error("conversion tracking error", e);
  }
})();
</script>

</Layout>
