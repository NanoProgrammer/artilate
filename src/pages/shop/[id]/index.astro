---
// src/pages/shop/[id].astro
import Layout from "../../../layouts/Layout.astro";
import ContextProduct from "../../../components/shop/contextProduct.jsx";
export const prerender = true;

/* Anchos fijos que vas a generar en /public/images */
const WIDTHS = [480, 800, 1200] as const;

/* Helpers para construir srcset desde un base SIN extensión ni sufijo de ancho */
const toSrcSet = (baseNoExt: string, ext: "avif" | "webp") =>
  WIDTHS.map((w) => `/images${baseNoExt}-${w}.${ext} ${w}w`).join(", ");

/* Quita /images y la extensión .avif/.webp para quedarte con el "base" */
const toBase = (p: string) =>
  p.replace(/^\/images/i, "").replace(/\.(avif|webp)$/i, "");

type Product = {
  id: string; name: string; price: number; category: string; tag?: string;
  shortDesc: string; longDesc: string; chips?: string[]; cacao?: string; weight?: string;
  dietary?: string[]; ingredients?: string; allergens?: string; images: string[]; content?: string[];
};

/* ================= CATALOGO (rutas bajo /public/images) ================= */
const CATALOG: Record<string, Product> = {
  "milk-37-pistachio": {
    id: "milk-37-pistachio",
    name: "37% Milky Pistachio Bar",
    price: 8,
    category: "Milk Chocolate",
    tag: "Bean-to-Bar",
    shortDesc: "Creamy 37% milk chocolate studded with pistachio pieces and a whisper of sea salt.",
    longDesc:
      "Silky, nostalgic 37% milk chocolate with pops of roasted pistachio and a pinch of sea salt to brighten the melt. Comforting, crunchy, and impossible to share.",
    chips: ["Creamy 37%", "Pistachio pieces"],
    cacao: "Milk chocolate • 37%",
    weight: "40 g",
    dietary: ["Contains milk"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, whole milk powder, pistachios (tree nuts), emulsifier (sunflower lecithin), natural flavours.",
    allergens: "Contains milk and tree nuts (pistachio). Made in a facility that handles other nuts.",
    images: [
      "/images/bars/milk-pistachio.webp",
      "/images/bars/milk-pistachio-1.webp",
      "/images/bars/milk-pistachio-2.webp",
    ],
    content: ["1 × 40 g bar", "Studded with roasted pistachio pieces"],
  },

  "milk-37-raspberry-crumble": {
    id: "milk-37-raspberry-crumble",
    name: "37% Milky Raspberry Crumble",
    price: 8,
    category: "Milk Chocolate",
    tag: "Kid-Friendly",
    shortDesc: "Silky 37% milk chocolate with raspberry crumble bits for a bright, crunchy finish.",
    longDesc:
      "A cheerful bar that pairs creamy 37% milk chocolate with tart raspberry crumble. Crunchy texture, fruity lift, and a smooth, milky finish.",
    chips: ["Raspberry crumble", "Creamy 37%"],
    cacao: "Milk chocolate • 37%",
    weight: "40 g",
    dietary: ["Contains milk"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, whole milk powder, raspberry crumble (raspberry, sugar), emulsifier (sunflower lecithin), natural flavours.",
    allergens: "Contains milk. Made in a facility that handles nuts.",
    images: [
      "/images/bars/milk-raspberry-crumble.webp",
      "/images/bars/milk-raspberry-crumble-1.webp",
      "/images/bars/milk-raspberry-crumble-2.webp",
      "/images/bars/milk-raspberry-crumble-3.webp",
    ],
    content: ["1 × 40 g bar", "Raspberry crumble bits"],
  },

  "dark-60-pistachio": {
    id: "dark-60-pistachio",
    name: "60% Dark Pistachio Bar",
    price: 11,
    category: "Nut Collection",
    shortDesc:
      "Balanced 64% dark chocolate layered with pistachio pieces—nutty, lightly sweet, satisfying.",
    longDesc:
      "A versatile 64% dark built for everyday snacking, speckled with roasted pistachios for a buttery crunch and a softly sweet finish.",
    chips: ["64% dark", "Pistachio pieces"],
    cacao: "Dark chocolate • 64%",
    weight: "40 g",
    ingredients:
      "Cocoa mass, organic cane sugar, cocoa butter, pistachios (tree nuts), emulsifier (sunflower lecithin), natural flavours.",
    allergens: "Contains tree nuts (pistachio). Made in a facility that handles milk and other nuts.",
    images: [
      "/images/bars/dark-pistachio.webp",
      "/images/bars/dark-pistachio-1.webp",
      "/images/bars/dark-pistachio-2.webp",
    ],
    content: ["1 × 40 g bar", "Roasted pistachio pieces"],
  },

  /* ================= BONBONS ================= */

  "classic-box-9": {
    id: "classic-box-9",
    name: "Classic Box — 9",
    price: 28,
    category: "Bonbons",
    tag: "Signature",
    shortDesc:
      "Nine signature bonbons spanning pistachio, caramel with blackberry, and chocolate and hazelnut.",
    longDesc: "Nine bonbons that embody the heart of Artilate’s craft...",
    chips: ["Gluten-free friendly", "Balanced"],
    cacao: "54% dark chocolate single-origin",
    weight: "9 bonbons",
    dietary: ["Gluten-free (not certified)"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, dairy, nuts, fruit purées, natural flavours.",
    allergens: "Contains dairy and nuts.",
    images: [
      "/images/bonbons/classic-9.webp",
      "/images/bonbons/classic-9-1.webp",
      "/images/bonbons/classic-9-2.webp",
    ],
    content: [
      "3 × Pistachio Praliné",
      "3 × Caramel with Blackberry",
      "3 × Chocolate & Hazelnut",
    ],
  },

  "tropical-box-9": {
    id: "tropical-box-9",
    name: "Tropical Box — 9",
    price: 25,
    category: "Bonbons",
    tag: "Fruity",
    shortDesc:
      "Exotic and vibrant: spicy pineapple, passionfruit, and coffee in silky dark chocolate shells.",
    longDesc: "An exploration of tropical intensity in three chapters...",
    chips: ["Tropical fruits", "Spice & coffee contrast"],
    cacao: "Single-origin Colombia • 52% dark chocolate",
    weight: "9 bonbons",
    dietary: ["May include dairy"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, dairy, fruit purées (pineapple, passionfruit), coffee, natural flavours, spices.",
    allergens: "Made in a facility that handles dairy and nuts.",
    images: [
      "/images/bonbons/tropical-9.webp",
      "/images/bonbons/tropical-9-1.webp",
      "/images/bonbons/tropical-9-2.webp",
    ],
    content: ["3 × Spicy Pineapple", "3 × Passionfruit", "3 × Coffee"],
  },

  "classic-box-8": {
    id: "classic-box-8",
    name: "Classic Box — 8",
    price: 28,
    category: "Bonbons",
    tag: "Signature",
    shortDesc:
      "Timeless signatures—silky caramels, pralinés and vanilla-forward ganaches.",
    longDesc: "Eight timeless pieces that showcase Artilate’s classic style...",
    chips: ["Crowd-pleaser"],
    cacao: "57% dark chocolate single-origin",
    weight: "8 bonbons",
    dietary: ["Contains dairy & nuts"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, dairy, nuts, natural flavours.",
    allergens: "Contains dairy and nuts.",
    images: [
      "/images/bonbons/classic-8.webp",
      "/images/bonbons/classic-8-1.webp",
      "/images/bonbons/classic-8-2.webp",
    ],
    content: [
      "2 × Caramel with Blackberry",
      "2 × Pistachio Praliné",
      "2 × Chocolate & Hazelnut",
      "2 × Strawberry",
    ],
  },

  "vibrant-box-8": {
    id: "vibrant-box-8",
    name: "Vibrant Box — 8",
    price: 23,
    category: "Bonbons",
    tag: "Fruity",
    shortDesc:
      "Eight vibrant bonbons — mango, spicy pineapple, passion fruit, and caramel with blackberry.",
    longDesc: "A tropical medley designed to awaken every sense...",
    chips: ["Seasonal fruit", "Tropical spice"],
    cacao: "Single-origin Colombia • 59% dark chocolate",
    weight: "8 bonbons",
    dietary: ["Contains dairy"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, dairy, fruit purées (mango, pineapple, passion fruit, blackberry), natural flavours, spices.",
    allergens: "Contains dairy. Made in a facility that handles nuts.",
    images: [
      "/images/bonbons/vibrant-8.webp",
      "/images/bonbons/vibrant-8-1.webp",
      "/images/bonbons/vibrant-8-2.webp",
      "/images/bonbons/vibrant-8-3.webp",
    ],
    content: ["2 × Mango", "2 × Spicy Pineapple", "2 × Passion Fruit", "2 × Caramel with Blackberry"],
  },

  "essentials-box-6": {
    id: "essentials-box-6",
    name: "Essentials Box — 6",
    price: 18,
    category: "Bonbons",
    tag: "Best Value",
    shortDesc:
      "Six essentials — pistachio, caramel with blackberry, chocolate & hazelnut, passionfruit, coffee, and strawberry.",
    longDesc: "A curated tasting set that captures Artilate’s signature balance...",
    chips: ["Gift-ready", "Balanced assortment"],
    cacao: "Single-origin Colombia • 53% dark chocolate",
    weight: "6 bonbons",
    dietary: ["Contains dairy & nuts"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, dairy, nuts (hazelnut, pistachio), fruit purées (blackberry, strawberry, passionfruit), coffee, natural flavours.",
    allergens: "Contains dairy and tree nuts (hazelnut, pistachio).",
    images: [
      "/images/bonbons/essentials-6.webp",
      "/images/bonbons/essentials-6-1.webp",
      "/images/bonbons/essentials-6-2.webp",
      "/images/bonbons/essentials-6-3.webp",
    ],
    content: [
      "1 × Pistachio Praliné",
      "1 × Caramel with Blackberry",
      "1 × Chocolate & Hazelnut",
      "1 × Passionfruit",
      "1 × Coffee",
      "1 × Strawberry",
    ],
  },

  /* ================= GIFTING ================= */

  "heart-gift-box": {
    id: "heart-gift-box",
    name: "Heart Gift Box",
    price: 99,
    category: "Gifting",
    shortDesc:
      "Thirty hand-painted heart bonbons — 16 caramel with blackberry, 10 pistachio, and 4 passionfruit.",
    longDesc: "Crafted as a gesture of love and artistry...",
    chips: ["Hand-painted", "Message card", "Gift-ready"],
    cacao: "Single-origin Colombia • 60% dark chocolate",
    weight: "40 bonbons",
    dietary: ["Contains dairy & nuts"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, dairy, nuts (pistachio), fruit purées (blackberry, passionfruit), natural flavours.",
    allergens: "Contains dairy and tree nuts (pistachio).",
    images: [
      "/images/gifts/heart-gift-box.webp",
      "/images/gifts/heart-gift-box-2.webp",
      "/images/gifts/heart-gift-box-3.webp",
      "/images/gifts/heart-gift-box-4.webp",
    ],
    content: [
      "20 × Caramel with Blackberry bonbons",
      "14 × Pistachio Praliné bonbons",
      "6 × Passionfruit bonbons",
      "Presented in a reusable keepsake tray",
    ],
  },

  "golden-ribbon-keepsake-box": {
    id: "golden-ribbon-keepsake-box",
    name: "Golden Ribbon Keepsake Box",
    price: 48,
    category: "Gifting",
    tag: "Ready-to-gift",
    shortDesc:
      "Reusable wooden keepsake box with a ribboned assortment — bonbons, chocolate bars, and coins.",
    longDesc: "A refined gift that embodies the spirit of Artilate craftsmanship...",
    chips: ["Wooden box", "Assorted chocolates", "Gift-ready"],
    cacao: "Single-origin Colombia • 54–63% dark & milk chocolate",
    weight: "Bonbons + 3 bars + 3 coins",
    dietary: ["Contains dairy & nuts"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, dairy, nuts (hazelnut, pistachio, almond), fruit purées (blackberry, mango, passionfruit, strawberry), coffee, natural flavours.",
    allergens: "Contains dairy and tree nuts (hazelnut, pistachio, almond).",
    images: [
      "/images/gifts/keepsake-wood-box.webp",
      "/images/gifts/keepsake-wood-box-1.webp",
      "/images/gifts/keepsake-wood-box-2.webp",
    ],
    content: [
      "1 × 8-piece bonbon selection (Pistachio, Caramel with Blackberry, Passionfruit, Mango, Strawberry, Chocolate & Hazelnut, Spicy Pineapple, Coffee — 1 each)",
      "2 × Milky Chocolate Bars (37%)",
      "1 × 63% Dark Chocolate Bar with Pistachio Crumble",
      "3 × Chocolate Coins with Nuts",
      "Reusable wooden keepsake box with golden ribbon",
    ],
  },
  "christmas-sharing-box-16": {
  id: "christmas-sharing-box-16",
  name: "Christmas Sharing Box — 16 Bonbons",
  price: 42,
  category: "Christmas Collection",
  tag: "Family Size",
  shortDesc:
    "Four crowd-favourite flavours, four bonbons each — crafted with single-origin Colombian cacao.",
  longDesc:
    "Designed for gatherings, this 16-piece sharing box features four flavours, four bonbons of each. Handcrafted with single-origin Colombian cacao, it highlights fruit, nuts, caramel, and festive touches for the holiday season.",
  chips: ["Single-origin cacao", "Sharing size", "Holiday Edition"],
  cacao: "Single-origin Colombia • 54–63%",
  weight: "16 bonbons",
  dietary: ["Contains dairy & tree nuts"],
  ingredients:
    "Cocoa mass, sugar, cocoa butter, dairy, nuts (hazelnut, pistachio), fruit purées (mango, pineapple, passionfruit, blackberry), natural flavours, spices.",
  allergens:
    "Contains dairy and tree nuts (hazelnut, pistachio). Made in a facility that handles other nuts.",
  images: [
    "/images/christmas/christmas-16-pieces-480.webp",
    "/images/christmas/christmas-16-pieces-800.webp",
    "/images/christmas/christmas-16-pieces-1200.webp"
  ],
  content: [
    "4 × Pistachio Praliné",
    "4 × Caramel with Blackberry",
    "4 × Passionfruit",
    "4 × Spicy Pineapple"
  ],
},
"christmas-tasting-box-12": {
  id: "christmas-tasting-box-12",
  name: "Christmas Tasting Box — 12 Bonbons",
  price: 32,
  category: "Christmas Collection",
  tag: "Limited Edition",
  shortDesc:
    "Six holiday-inspired flavours crafted with single-origin Colombian cacao — including Coconut & Orange.",
  longDesc:
    "A festive selection of artisanal bonbons handcrafted with single-origin Colombian cacao. This holiday-only box includes six flavours, two bonbons of each — blending fruit, nuts, citrus, and classic Christmas notes for a joyful tasting experience.",
  chips: ["Single-origin cacao", "Handcrafted", "Holiday Edition"],
  cacao: "Single-origin Colombia • 54–63%",
  weight: "12 bonbons",
  dietary: ["Contains dairy & tree nuts"],
  ingredients:
    "Cocoa mass, sugar, cocoa butter, dairy, nuts (hazelnut, pistachio, coconut), fruit purées (orange, mango, pineapple, passionfruit, blackberry, strawberry), natural flavours, coffee.",
  allergens:
    "Contains dairy and tree nuts (hazelnut, pistachio, coconut). Made in a facility that handles other nuts.",
  images: [
    "/images/christmas/christmas-12-pieces-480.webp",
    "/images/christmas/christmas-12-pieces-800.webp",
    "/images/christmas/christmas-12-pieces-1200.webp"
  ],
  content: [
    "2 × Pistachio Praliné",
    "2 × Caramel with Blackberry",
    "2 × Chocolate & Hazelnut",
    "2 × Passionfruit",
    "2 × Mango",
    "2 × Coconut & Orange"
  ],
}

};

/* ================ Static paths ================ */
export function getStaticPaths() {
  const CATALOG: Record<string, Product> = {
  "milk-37-pistachio": {
    id: "milk-37-pistachio",
    name: "37% Milky Pistachio Bar",
    price: 8,
    category: "Milk Chocolate",
    tag: "Bean-to-Bar",
    shortDesc: "Creamy 37% milk chocolate studded with pistachio pieces and a whisper of sea salt.",
    longDesc:
      "Silky, nostalgic 37% milk chocolate with pops of roasted pistachio and a pinch of sea salt to brighten the melt. Comforting, crunchy, and impossible to share.",
    chips: ["Creamy 37%", "Pistachio pieces"],
    cacao: "Milk chocolate • 37%",
    weight: "40 g",
    dietary: ["Contains milk"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, whole milk powder, pistachios (tree nuts), emulsifier (sunflower lecithin), natural flavours.",
    allergens: "Contains milk and tree nuts (pistachio). Made in a facility that handles other nuts.",
    images: [
      "/images/bars/milk-pistachio.webp",
      "/images/bars/milk-pistachio-1.webp",
      "/images/bars/milk-pistachio-2.webp",
    ],
    content: ["1 × 40 g bar", "Studded with roasted pistachio pieces"],
  },
  "milk-37-raspberry-crumble": {
    id: "milk-37-raspberry-crumble",
    name: "37% Milky Raspberry Crumble",
    price: 8,
    category: "Milk Chocolate",
    tag: "Kid-Friendly",
    shortDesc: "Silky 37% milk chocolate with raspberry crumble bits for a bright, crunchy finish.",
    longDesc:
      "A cheerful bar that pairs creamy 37% milk chocolate with tart raspberry crumble. Crunchy texture, fruity lift, and a smooth, milky finish.",
    chips: ["Raspberry crumble", "Creamy 37%"],
    cacao: "Milk chocolate • 37%",
    weight: "40 g",
    dietary: ["Contains milk"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, whole milk powder, raspberry crumble (raspberry, sugar), emulsifier (sunflower lecithin), natural flavours.",
    allergens: "Contains milk. Made in a facility that handles nuts.",
    images: [
      "/images/bars/milk-raspberry-crumble.webp",
      "/images/bars/milk-raspberry-crumble-1.webp",
      "/images/bars/milk-raspberry-crumble-2.webp",
      "/images/bars/milk-raspberry-crumble-3.webp",
    ],
    content: ["1 × 40 g bar", "Raspberry crumble bits"],
  },

  "dark-60-pistachio": {
    id: "dark-60-pistachio",
    name: "60% Dark Pistachio Bar",
    price: 11,
    category: "Nut Collection",
    shortDesc:
      "Balanced 64% dark chocolate layered with pistachio pieces—nutty, lightly sweet, satisfying.",
    longDesc:
      "A versatile 64% dark built for everyday snacking, speckled with roasted pistachios for a buttery crunch and a softly sweet finish.",
    chips: ["64% dark", "Pistachio pieces"],
    cacao: "Dark chocolate • 64%",
    weight: "40 g",
    ingredients:
      "Cocoa mass, organic cane sugar, cocoa butter, pistachios (tree nuts), emulsifier (sunflower lecithin), natural flavours.",
    allergens: "Contains tree nuts (pistachio). Made in a facility that handles milk and other nuts.",
    images: [
      "/images/bars/dark-pistachio.webp",
      "/images/bars/dark-pistachio-1.webp",
      "/images/bars/dark-pistachio-2.webp",
    ],
    content: ["1 × 40 g bar", "Roasted pistachio pieces"],
  },

  /* ================= BONBONS ================= */

  "classic-box-9": {
    id: "classic-box-9",
    name: "Classic Box — 9",
    price: 28,
    category: "Bonbons",
    tag: "Signature",
    shortDesc:
      "Nine signature bonbons spanning pistachio, caramel with blackberry, and chocolate and hazelnut.",
    longDesc: "Nine bonbons that embody the heart of Artilate’s craft...",
    chips: ["Gluten-free friendly", "Balanced"],
    cacao: "54% dark chocolate single-origin",
    weight: "9 bonbons",
    dietary: ["Gluten-free (not certified)"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, dairy, nuts, fruit purées, natural flavours.",
    allergens: "Contains dairy and nuts.",
    images: [
      "/images/bonbons/classic-9.webp",
      "/images/bonbons/classic-9-1.webp",
      "/images/bonbons/classic-9-2.webp",
    ],
    content: [
      "3 × Pistachio Praliné",
      "3 × Caramel with Blackberry",
      "3 × Chocolate & Hazelnut",
    ],
  },

  "tropical-box-9": {
    id: "tropical-box-9",
    name: "Tropical Box — 9",
    price: 25,
    category: "Bonbons",
    tag: "Fruity",
    shortDesc:
      "Exotic and vibrant: spicy pineapple, passionfruit, and coffee in silky dark chocolate shells.",
    longDesc: "An exploration of tropical intensity in three chapters...",
    chips: ["Tropical fruits", "Spice & coffee contrast"],
    cacao: "Single-origin Colombia • 52% dark chocolate",
    weight: "9 bonbons",
    dietary: ["May include dairy"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, dairy, fruit purées (pineapple, passionfruit), coffee, natural flavours, spices.",
    allergens: "Made in a facility that handles dairy and nuts.",
    images: [
      "/images/bonbons/tropical-9.webp",
      "/images/bonbons/tropical-9-1.webp",
      "/images/bonbons/tropical-9-2.webp",
    ],
    content: ["3 × Spicy Pineapple", "3 × Passionfruit", "3 × Coffee"],
  },

  "classic-box-8": {
    id: "classic-box-8",
    name: "Classic Box — 8",
    price: 28,
    category: "Bonbons",
    tag: "Signature",
    shortDesc:
      "Timeless signatures—silky caramels, pralinés and vanilla-forward ganaches.",
    longDesc: "Eight timeless pieces that showcase Artilate’s classic style...",
    chips: ["Crowd-pleaser"],
    cacao: "57% dark chocolate single-origin",
    weight: "8 bonbons",
    dietary: ["Contains dairy & nuts"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, dairy, nuts, natural flavours.",
    allergens: "Contains dairy and nuts.",
    images: [
      "/images/bonbons/classic-8.webp",
      "/images/bonbons/classic-8-1.webp",
      "/images/bonbons/classic-8-2.webp",
    ],
    content: [
      "2 × Caramel with Blackberry",
      "2 × Pistachio Praliné",
      "2 × Chocolate & Hazelnut",
      "2 × Strawberry",
    ],
  },

  "vibrant-box-8": {
    id: "vibrant-box-8",
    name: "Vibrant Box — 8",
    price: 23,
    category: "Bonbons",
    tag: "Fruity",
    shortDesc:
      "Eight vibrant bonbons — mango, spicy pineapple, passion fruit, and caramel with blackberry.",
    longDesc: "A tropical medley designed to awaken every sense...",
    chips: ["Seasonal fruit", "Tropical spice"],
    cacao: "Single-origin Colombia • 59% dark chocolate",
    weight: "8 bonbons",
    dietary: ["Contains dairy"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, dairy, fruit purées (mango, pineapple, passion fruit, blackberry), natural flavours, spices.",
    allergens: "Contains dairy. Made in a facility that handles nuts.",
    images: [
      "/images/bonbons/vibrant-8.webp",
      "/images/bonbons/vibrant-8-1.webp",
      "/images/bonbons/vibrant-8-2.webp",
      "/images/bonbons/vibrant-8-3.webp",
    ],
    content: ["2 × Mango", "2 × Spicy Pineapple", "2 × Passion Fruit", "2 × Caramel with Blackberry"],
  },

  "essentials-box-6": {
    id: "essentials-box-6",
    name: "Essentials Box — 6",
    price: 18,
    category: "Bonbons",
    tag: "Best Value",
    shortDesc:
      "Six essentials — pistachio, caramel with blackberry, chocolate & hazelnut, passionfruit, coffee, and strawberry.",
    longDesc: "A curated tasting set that captures Artilate’s signature balance...",
    chips: ["Gift-ready", "Balanced assortment"],
    cacao: "Single-origin Colombia • 53% dark chocolate",
    weight: "6 bonbons",
    dietary: ["Contains dairy & nuts"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, dairy, nuts (hazelnut, pistachio), fruit purées (blackberry, strawberry, passionfruit), coffee, natural flavours.",
    allergens: "Contains dairy and tree nuts (hazelnut, pistachio).",
    images: [
      "/images/bonbons/essentials-6.webp",
      "/images/bonbons/essentials-6-1.webp",
      "/images/bonbons/essentials-6-2.webp",
      "/images/bonbons/essentials-6-3.webp",
    ],
    content: [
      "1 × Pistachio Praliné",
      "1 × Caramel with Blackberry",
      "1 × Chocolate & Hazelnut",
      "1 × Passionfruit",
      "1 × Coffee",
      "1 × Strawberry",
    ],
  },

  /* ================= GIFTING ================= */

  "heart-gift-box": {
    id: "heart-gift-box",
    name: "Heart Gift Box",
    price: 86,
    category: "Gifting",
    shortDesc:
      "Thirty hand-painted heart bonbons — 16 caramel with blackberry, 10 pistachio, and 4 passionfruit.",
    longDesc: "Crafted as a gesture of love and artistry...",
    chips: ["Hand-painted", "Message card", "Gift-ready"],
    cacao: "Single-origin Colombia • 60% dark chocolate",
    weight: "30 bonbons",
    dietary: ["Contains dairy & nuts"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, dairy, nuts (pistachio), fruit purées (blackberry, passionfruit), natural flavours.",
    allergens: "Contains dairy and tree nuts (pistachio).",
    images: [
      "/images/gifts/heart-gift-box.webp",
      "/images/gifts/heart-gift-box-1.webp",
      "/images/gifts/heart-gift-box-2.webp",
      "/images/gifts/heart-gift-box-3.webp",
      "/images/gifts/heart-gift-box-4.webp",
    ],
    content: [
      "16 × Caramel with Blackberry bonbons",
      "10 × Pistachio Praliné bonbons",
      "4 × Passionfruit bonbons",
      "Presented in a reusable keepsake tray",
    ],
  },

  "golden-ribbon-keepsake-box": {
    id: "golden-ribbon-keepsake-box",
    name: "Golden Ribbon Keepsake Box",
    price: 48,
    category: "Gifting",
    tag: "Ready-to-gift",
    shortDesc:
      "Reusable wooden keepsake box with a ribboned assortment — bonbons, chocolate bars, and coins.",
    longDesc: "A refined gift that embodies the spirit of Artilate craftsmanship...",
    chips: ["Wooden box", "Assorted chocolates", "Gift-ready"],
    cacao: "Single-origin Colombia • 54–63% dark & milk chocolate",
    weight: "Bonbons + 3 bars + 3 coins",
    dietary: ["Contains dairy & nuts"],
    ingredients:
      "Cocoa mass, sugar, cocoa butter, dairy, nuts (hazelnut, pistachio, almond), fruit purées (blackberry, mango, passionfruit, strawberry), coffee, natural flavours.",
    allergens: "Contains dairy and tree nuts (hazelnut, pistachio, almond).",
    images: [
      "/images/gifts/keepsake-wood-box.webp",
      "/images/gifts/keepsake-wood-box-1.webp",
      "/images/gifts/keepsake-wood-box-2.webp",
    ],
    content: [
      "1 × 8-piece bonbon selection (Pistachio, Caramel with Blackberry, Passionfruit, Mango, Strawberry, Chocolate & Hazelnut, Spicy Pineapple, Coffee — 1 each)",
      "2 × Milky Chocolate Bars (37%)",
      "1 × 63% Dark Chocolate Bar with Pistachio Crumble",
      "3 × Chocolate Coins with Nuts",
      "Reusable wooden keepsake box with golden ribbon",
    ],
  },
    "christmas-sharing-box-16": {
  id: "christmas-sharing-box-16",
  name: "Christmas Sharing Box — 16 Bonbons",
  price: 42,
  category: "Christmas Collection",
  tag: "Family Size",
  shortDesc:
    "Four crowd-favourite flavours, four bonbons each — crafted with single-origin Colombian cacao.",
  longDesc:
    "Designed for gatherings, this 16-piece sharing box features four flavours, four bonbons of each. Handcrafted with single-origin Colombian cacao, it highlights fruit, nuts, caramel, and festive touches for the holiday season.",
  chips: ["Single-origin cacao", "Sharing size", "Holiday Edition"],
  cacao: "Single-origin Colombia • 54–63%",
  weight: "16 bonbons",
  dietary: ["Contains dairy & tree nuts"],
  ingredients:
    "Cocoa mass, sugar, cocoa butter, dairy, nuts (hazelnut, pistachio), fruit purées (mango, pineapple, passionfruit, blackberry), natural flavours, spices.",
  allergens:
    "Contains dairy and tree nuts (hazelnut, pistachio). Made in a facility that handles other nuts.",
  images: [
    "/images/christmas/christmas-16-pieces-480.webp",
    "/images/christmas/christmas-16-pieces-800.webp",
    "/images/christmas/christmas-16-pieces-1200.webp"
  ],
  content: [
    "4 × Pistachio Praliné",
    "4 × Caramel with Blackberry",
    "4 × Passionfruit",
    "4 × Spicy Pineapple"
  ],
},
"christmas-tasting-box-12": {
  id: "christmas-tasting-box-12",
  name: "Christmas Tasting Box — 12 Bonbons",
  price: 32,
  category: "Christmas Collection",
  tag: "Limited Edition",
  shortDesc:
    "Six holiday-inspired flavours crafted with single-origin Colombian cacao — including Coconut & Orange.",
  longDesc:
    "A festive selection of artisanal bonbons handcrafted with single-origin Colombian cacao. This holiday-only box includes six flavours, two bonbons of each — blending fruit, nuts, citrus, and classic Christmas notes for a joyful tasting experience.",
  chips: ["Single-origin cacao", "Handcrafted", "Holiday Edition"],
  cacao: "Single-origin Colombia • 54–63%",
  weight: "12 bonbons",
  dietary: ["Contains dairy & tree nuts"],
  ingredients:
    "Cocoa mass, sugar, cocoa butter, dairy, nuts (hazelnut, pistachio, coconut), fruit purées (orange, mango, pineapple, passionfruit, blackberry, strawberry), natural flavours, coffee.",
  allergens:
    "Contains dairy and tree nuts (hazelnut, pistachio, coconut). Made in a facility that handles other nuts.",
  images: [
    "/images/christmas/christmas-12-pieces-480.webp",
    "/images/christmas/christmas-12-pieces-800.webp",
    "/images/christmas/christmas-12-pieces-1200.webp"
  ],
  content: [
    "2 × Pistachio Praliné",
    "2 × Caramel with Blackberry",
    "2 × Chocolate & Hazelnut",
    "2 × Passionfruit",
    "2 × Mango",
    "2 × Coconut & Orange"
  ],
}
};
  return Object.keys(CATALOG).map((id) => ({
    params: { id },
    props: { product: CATALOG[id] },
  }));
}

/* ================ Page props ================ */
const { id } = Astro.params;
const product = CATALOG[id as keyof typeof CATALOG] ?? null;
if (!product) Astro.response.status = 404;

/* ================ SEO + responsive ================ */
const title = product ? `${product.name} | Artilate` : "Product not found | Artilate";
const description = product?.shortDesc ?? "Explore Artilate chocolates.";

/* Bases (sin extensión) */
const heroBase = product ? toBase(product.images[0]) : null;
const thumbBases = (product?.images ?? []).slice(1).map(toBase);

/* OG/preview image que SÍ existe (no uses basename) */
const ogImage = heroBase ? `/images${heroBase}-1200.avif` : "/assets/shop-hero-og.jpg";

/* sizes */
const sizesHero = "(max-width: 640px) 100vw, (max-width: 1024px) 80vw, 960px";
const sizesThumb = "(max-width: 640px) 33vw, (max-width: 1024px) 200px, 320px";
---

<Layout
  title={title}
  description={description}
  image={ogImage}
  breadcrumbs={[
    { href: "/", name: "Home" },
    { href: "/shop", name: "Shop" },
    ...(product ? [{ href: `/shop/${id}`, name: product.name }] : []),
  ]}
>
  {/* ===== HEAD: Preload del LCP en AVIF + WebP ===== */}
  {heroBase && (
    <Fragment slot="head">
      <link
        rel="preload"
        as="image"
        imagesrcset={toSrcSet(heroBase, "avif")}
        imagesizes={sizesHero}
        type="image/avif"
        fetchpriority="high"
      />
      <link
        rel="preload"
        as="image"
        imagesrcset={toSrcSet(heroBase, "webp")}
        imagesizes={sizesHero}
        type="image/webp"
        fetchpriority="high"
      />
    </Fragment>
  )}

  {product ? (
    <>
      {/* Island mínima */}
      <ContextProduct client:visible product={product} />

      {/* ===== Galería ===== */}
      <section class="mx-auto mt-8 max-w-5xl px-4">
        <div class="grid grid-cols-1 gap-4 sm:grid-cols-12">

          {/* HERO */}
          <figure class="sm:col-span-7">
            {heroBase && (
              <picture>
  <source type="image/avif" srcset={toSrcSet(heroBase, "avif")} sizes={sizesHero} />
  <source type="image/webp" srcset={toSrcSet(heroBase, "webp")} sizes={sizesHero} />
  {/* Fallback: el <img> también tiene srcset con 480/800/1200 */}
  <img
    src={`/images${heroBase}-800.webp`}
    srcset={toSrcSet(heroBase, "webp")}
    sizes={sizesHero}
    alt={`${product.name} — main`}
    width="800"
    height="800"
    loading="eager"
    decoding="async"
    fetchpriority="high"
    onerror="if(!this.dataset.alt){this.dataset.alt=1;this.src=this.src.replace('.webp','.avif');this.srcset=this.srcset.replaceAll('.webp','.avif');}"
    class="aspect-square w-full rounded-2xl border border-zinc-800 object-cover"
  />
</picture>
            )}
          </figure>

          {/* THUMBS */}
          <div class="sm:col-span-5 grid grid-cols-3 gap-3">
            {thumbBases.map((base, i) => (
  <picture>
    <source type="image/avif" srcset={toSrcSet(base, "avif")} sizes={sizesThumb} />
    <source type="image/webp" srcset={toSrcSet(base, "webp")} sizes={sizesThumb} />
    <img
      src={`/images${base}-480.webp`}
      srcset={toSrcSet(base, "webp")}
      sizes={sizesThumb}
      alt={`${product.name} — gallery ${i + 1}`}
      width="480"
      height="480"
      loading="lazy"
      decoding="async"
      onerror="if(!this.dataset.alt){this.dataset.alt=1;this.src=this.src.replace('.webp','.avif');this.srcset=this.srcset.replaceAll('.webp','.avif');}"
      class="aspect-square w-full rounded-xl border border-zinc-800 object-cover"
    />
  </picture>
))}

          </div>
        </div>
      </section>
    </>
  ) : (
    <section class="mx-auto max-w-5xl px-4 py-24 text-center text-zinc-200">
      <h1 class="mb-3 text-3xl font-extrabold">Product not found</h1>
      <p class="mb-6 text-zinc-400">We couldn’t locate that item. Try browsing the shop instead.</p>
      <a href="/shop" class="inline-flex items-center gap-2 rounded-lg bg-amber-400 px-4 py-2 font-extrabold text-zinc-900">
        Back to shop
      </a>
    </section>
  )}

  {/* ===== JSON-LD ===== */}
  <slot name="jsonld">
    {product && (
      <script type="application/ld+json">
        {JSON.stringify({
          "@context": "https://schema.org",
          "@type": "Product",
          sku: product.id,
          name: product.name,
          description: product.shortDesc,
          category: product.category,
          image: (product.images || []).map((p) =>
            new URL(p.replace(/^\//, "/"), Astro.site ?? "https://artilate.ca").toString()
          ),
          brand: { "@type": "Brand", name: "Artilate" },
          offers: {
            "@type": "Offer",
            availability: "https://schema.org/InStock",
            priceCurrency: "CAD",
            price: product.price,
            url: new URL(`/shop/${product.id}`, Astro.site ?? "https://artilate.ca").toString(),
          },
        })}
      </script>
    )}
  </slot>
</Layout>

<style is:global>
  .aspect-square { aspect-ratio: 1 / 1; }
</style>
